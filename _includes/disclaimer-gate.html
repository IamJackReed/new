<script>
  (function () {
    const disclaimerUrl = "{{ '/disclaimer/' | relative_url }}";

    function normalizePath(path) {
      if (!path) return '/';
      return path.replace(/\/+$/, '') || '/';
    }

    var normalizedDisclaimer = normalizePath(disclaimerUrl);
    var normalizedCurrent = normalizePath(window.location.pathname);

    var accepted = false;
    try {
      accepted = localStorage.getItem('disclaimerAccepted:v1') === 'true';
    } catch (e) {
      accepted = false;
    }

    if (accepted || normalizedCurrent === normalizedDisclaimer) {
      return;
    }

    var target = window.location.pathname + window.location.search + window.location.hash;

    try {
      sessionStorage.setItem('postDisclaimerRedirect', target);
    } catch (e) {
      // sessionStorage may be unavailable; proceed to redirect
    }

    window.location.href = disclaimerUrl;
  })();
</script>
